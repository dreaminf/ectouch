<!DOCTYPE html>
<html>

	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black" />
		<meta name="format-detection" content="telephone=no" />
		<meta charset="utf-8">
		<title>我的团</title>
		<link rel="stylesheet" href="__TPL__/team/css/ectouch.css" />

	</head>

	<body>
		<div id="loading"><img src="__TPL__/team/images/loading.gif" /></div>
		<div class="con">
			<div class="goods-info user-order of-hidden ect-tab ts-3">
				<nav class=" tab-title b-color-f of-hidden">
					<ul class="dis-box">
						<li class="box-flex <!--{if $type eq 1}-->active<!--{/if}-->" style="display:none"><a href="{:url('user/my_team',array('type'=>'1'))}">全部团</a></li>
						<li class="box-flex <!--{if $type eq 2}-->active<!--{/if}-->"><a href="{:url('user/my_team',array('type'=>'2'))}">正在拼团</a></li>
						<li class="box-flex <!--{if $type eq 3}-->active<!--{/if}-->"><a href="{:url('user/my_team',array('type'=>'3'))}">成功团</a></li>
						<li class="box-flex <!--{if $type eq 4}-->active<!--{/if}-->"><a href="{:url('user/my_team',array('type'=>'4'))}">失败团</a></li>
					</ul>
				</nav>
				<div id="j-tab-con" class="tab-con">
					<div class="swiper-wrapper">
						<section class="swiper-slide" id="j-product-box">						
							<script id="j-product" type="text/html">
							<%each list as vo %>							
							<section class="flow-checkout-pro m-top08">
								<div class="m-top1px of-hidden padding-all b-color-f position-rel">
									<div class="product-one-list-1 of-hidden j-g-s-p-con">
										<div class="swiper-wrapper ">
											<li class="swiper-slide swiper-slide-active">
												<div class="product-div">
													<a class="product-div-link" href="<%vo.url%>"></a>
													<img class="product-list-img bd" src="<%vo.goods_img%>">

												</div>
											</li>
											<div class="t-list-right-box position-rel">
												<a class="product-div-link" href="<%vo.url%>"></a>
												<h4 class="font-07 col-5 onelist-hidden"><%vo.goods_name%></h4>
												<p class="font-03 col-9">已有<%vo.limit_num%>人参团</p>
												<span class="ec-color font-07">￥<%vo.team_price%> 元</span>
											</div>

										</div>
									</div>
									<!--成功时显示-->
									<%if vo.status ==1%>
									<div class="team-ts-img position-abo"><img src="__TPL__/team/images/s-bg.png"></div>
									<%/if%>
									<!--失败显示-->
									<%if vo.status == 2%>
									<div class="team-ts-img position-abo"><img src="__TPL__/team/images/sb-bg.png"></div>
									<%/if%>
								</div>								
								<footer class="padding-all b-color-f  of-hidden dis-box m-top1px">
									<h4 class="box-flex"></h4>
									<p class="ect-button-more">
										<a href="<%vo.order_url%>" class="btn-opacity b-s">查看订单</a>
										<%if vo.pay_status == 2%>
										<a href="<%vo.team__url%>" class="btn-opacity b-s">拼团进度</a>
										<%/if%>
									</p>
								</footer>
							</section>
							
							<%/each%>
							</script>
							{if $is_show eq 1}
							<div class="no-div-message">
								<i class="iconfont icon-biaoqingleiben"></i>
								<p>亲，此处没有内容～！</p>
							</div>
							{/if}
						</section>
					</div>
				</div>
			</div>
		</div>
		</div>
		<!--引用js-->
		<script type="text/javascript" src="__TPL__/team/js/jquery-2.1.4.min.js"></script>
		<script type="text/javascript" src="__TPL__/team/js/swiper.min.js"></script>
		<script type="text/javascript" src="__TPL__/team/js/ectouch.js"></script>
		
		<script type="text/javascript" src="__TPL__/statics/js/echo.min.js"></script>
		<script type="text/javascript" src="__PUBLIC__/js/template.js"></script>
		<script type="text/javascript">			
			var url = '{:url('user/my_team', array( 'type'=>$this->_var['type']))}';
			var total = 0;
			
			var page = {$page};

			page = (page === null) ? 1:parseInt(page);
			
			get_data(page);
			localData.set('page', page);
			if(page == 1){
				localData.set('page_min', 1);
				localData.set('page_max', 1);
			}
			if(page > 1){
				localData.set('page_min', page);
				localData.set('page_max', page);
			}
			var minPage = localData.get('page_max');
			var maxPage = localData.get('page_max');
			minPage = (minPage === null) ? 1:parseInt(minPage);
			maxPage = (maxPage === null) ? 1:parseInt(maxPage);

			$(window).scroll(function () {
				var scrollTop = $(this).scrollTop();
				var scrollHeight = $(document).height();
				var windowHeight = $(this).height();
				
				// 下拉
				if (scrollTop + windowHeight == scrollHeight) {
					if(page >= maxPage){
						$.ajax({
							type : "post",
							url : url,
							data : {
							    page : page+1,
							},
							dataType: 'json',
							async : false,
							success : function(data){
								//template.config('openTag', '<%');
								//template.config('closeTag', '%>');
								var html = template('j-product', data);
								$('#j-product-box').append(html);
								//rug
								if(!isEmpty(data.list)){
									page++;
									localData.set('page', page);
									if(page > maxPage){
										localData.set('page_max', page);
									}
								}
							}
						});
					}
				}
				// 上拉
				if(scrollTop == 0 && minPage > 1){
					$.ajax({
						type : "post",
						url : url,
						data : 'page=' + (page - 1),
						dataType: 'json',
						async : false,
						success : function(data){
							//template.config('openTag', '<%');
							//template.config('closeTag', '%>');
							var html = template('j-product', data);
							$('#j-product-box').prepend(html);
							page--;
							localData.set('page', page);
							if(page < minPage){
								localData.set('page_min', page);
							}
						}
					});
				}
			});

			function get_data(page){
				$.ajax({
					type : "post",
					url : url,
					data : {
						page : 1,
					},
					dataType: 'json',
					async : false,
					success : function(data){
						template.config('openTag', '<%');
                        template.config('closeTag', '%>');
						var html = template('j-product', data);
						//alert(html);
						$('#j-product-box').append(html);
					}
				});
			}
			/*
			   * 检测对象是否是空对象(不包含任何可读属性)。
			   * 方法既检测对象本身的属性，也检测从原型继承的属性(因此没有使hasOwnProperty)。
			   */
		   function isEmpty(obj) {
			   for (var name in obj) {
				   return false;
			   }
			   return true;
		   }
		  echo.init();
	
			$(function($) {
				$(".j-detail-close").click(function(){
					$(".raise-search-cont").addClass("active");
				})
				//nav
				window.onload = function() {
					var $li = $('.raise-cate-nav li');
					var $ul = $('.raise-content ul');

					$li.click(function() {
						var $this = $(this);
						var $t = $this.index();
						$li.removeClass();
						$this.addClass('current');
						$ul.css('display', 'none');
						$ul.eq($t).css('display', 'block');
					})
				}
				$(".j-text-all,.raise-bg-box").click(function() {
					$(".raise-content").addClass("active");
					$(".raise-bg-box").addClass("active");
					$(".category-header-box").addClass("active");
				});
				$(".raise-cate-nav li").click(function() {
					$(".raise-content").removeClass("active");
					$(".raise-bg-box").removeClass("active");
					$(".category-header-box").removeClass("active");
				});
			});
		</script>
		<script>
			/*店铺信息商品滚动*/
			var swiper = new Swiper('.j-g-s-p-con', {
				scrollbarHide: true,
				slidesPerView: 'auto',
				centeredSlides: false,
				grabCursor: true
			});

			/*切换*/
			var tabsSwiper = new Swiper('#j-tab-con', {
				speed: 100,
				noSwiping: true,
				autoHeight: true,
				onSlideChangeStart: function() {
					$(".j-tab-title .active").removeClass('active')
					$(".j-tab-title li").eq(tabsSwiper.activeIndex).addClass('active')
				}
			})
			$(".j-tab-title li").on('touchstart mousedown', function(e) {
				e.preventDefault()
				$(".j-tab-title .active").removeClass('active')
				$(this).addClass('active')
				tabsSwiper.slideTo($(this).index())
			})
			$(".j-tab-title li").click(function(e) {
				e.preventDefault()
			})
		</script>
	</body>

</html>